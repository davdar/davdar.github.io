<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE 
    ConstraintKinds
   ,DataKinds
   ,ExplicitNamespaces
   ,FlexibleContexts
   ,FlexibleInstances
   ,FunctionalDependencies
   ,GADTs
   ,GeneralizedNewtypeDeriving
   ,InstanceSigs
   ,KindSignatures
   ,LambdaCase
   ,MonadComprehensions
   ,MultiParamTypeClasses
   ,NoImplicitPrelude
   ,OverloadedStrings
   ,PartialTypeSignatures
   ,PatternSynonyms
   ,PolyKinds
   ,QuantifiedConstraints
   ,RankNTypes
   ,RebindableSyntax
   ,ScopedTypeVariables
   ,StandaloneDeriving
   ,Strict
   ,StrictData
   ,TemplateHaskell
   ,TypeApplications
   ,TypeFamilies
   ,TypeOperators
   ,UndecidableInstances
   ,UndecidableSuperClasses
   ,UnicodeSyntax
   ,ViewPatterns 
   ,DeriveLift #-}</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lang.L2C.Util</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UVMHS</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="Util.Lex.html"><span class="hs-identifier">Util.Lex</span></a><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="Lang.L2C.Data.html"><span class="hs-identifier">Lang.L2C.Data</span></a><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">HS</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Syntax</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">QQ</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.Haskell.TH.Quote</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">QQ</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-identifier hs-var">makePrettySum</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">Expr</span><span>
</span><a name="line-50"></a><span class="hs-identifier hs-var">makePrettySum</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">Value</span><span>
</span><a name="line-51"></a><span class="hs-identifier hs-var">makePrettySum</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">Answer</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">QQ.Lift</span><span> </span><a href="Lang.L2C.Data.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">QQ.Lift</span><span> </span><a href="Lang.L2C.Data.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">QQ.Lift</span><span> </span><a href="Lang.L2C.Data.html#Answer"><span class="hs-identifier hs-type">Answer</span></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-identifier">pExpr</span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-identifier hs-type">CParser</span><span> </span><span class="hs-identifier hs-type">TokenBasic</span><span> </span><a href="Lang.L2C.Data.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span>
</span><a name="line-58"></a><a name="pExpr"><a href="Lang.L2C.Util.html#pExpr"><span class="hs-identifier">pExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cpNewContext</span><span> </span><span class="hs-string">&quot;expression&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mixfix</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">mixTerminal</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">cpSyntax</span><span> </span><span class="hs-string">&quot;(&quot;</span><span> </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679096489"><a href="#local-6989586621679096489"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&#8592;</span><span> </span><a href="Lang.L2C.Util.html#pExpr"><span class="hs-identifier hs-var">pExpr</span></a><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">cpSyntax</span><span> </span><span class="hs-string">&quot;)&quot;</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679096489"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-60"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mixTerminal</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679096490"><a href="#local-6989586621679096490"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&#8592;</span><span> </span><span class="hs-identifier hs-var">cpInteger</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lang.L2C.Data.html#IntE"><span class="hs-identifier hs-var">IntE</span></a><span> </span><a href="#local-6989586621679096490"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-61"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mixInfixL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">&#120159;64</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">cpSyntax</span><span> </span><span class="hs-string">&quot;+&quot;</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Lang.L2C.Data.html#PlusE"><span class="hs-identifier hs-var">PlusE</span></a><span>
</span><a name="line-62"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mixInfixL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">&#120159;64</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">cpSyntax</span><span> </span><span class="hs-string">&quot;*&quot;</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Lang.L2C.Data.html#TimesE"><span class="hs-identifier hs-var">TimesE</span></a><span>
</span><a name="line-63"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mixTerminal</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679096491"><a href="#local-6989586621679096491"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&#8592;</span><span> </span><a href="Util.Lex.html#pBool"><span class="hs-identifier hs-var">pBool</span></a><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lang.L2C.Data.html#BoolE"><span class="hs-identifier hs-var">BoolE</span></a><span> </span><a href="#local-6989586621679096491"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-64"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mixInfixL</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">&#120159;64</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">cpSyntax</span><span> </span><span class="hs-string">&quot;||&quot;</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Lang.L2C.Data.html#OrE"><span class="hs-identifier hs-var">OrE</span></a><span>
</span><a name="line-65"></a><span>  </span><span class="hs-comment">-- , mixInfixL (&#120159;64 3) $ do cpSyntax &quot;&amp;&amp;&quot; ; return AndE</span><span>
</span><a name="line-66"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mixPrefix</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">&#120159;64</span><span> </span><span class="hs-number">4</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">cpSyntax</span><span> </span><span class="hs-string">&quot;!&quot;</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Lang.L2C.Data.html#NegE"><span class="hs-identifier hs-var">NegE</span></a><span>
</span><a name="line-67"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mixInfix</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">&#120159;64</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">cpSyntax</span><span> </span><span class="hs-string">&quot;==&quot;</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Lang.L2C.Data.html#EqE"><span class="hs-identifier hs-var">EqE</span></a><span>
</span><a name="line-68"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-identifier">pValue</span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-identifier hs-type">CParser</span><span> </span><span class="hs-identifier hs-type">TokenBasic</span><span> </span><a href="Lang.L2C.Data.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-71"></a><a name="pValue"><a href="Lang.L2C.Util.html#pValue"><span class="hs-identifier">pValue</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cpNewContext</span><span> </span><span class="hs-string">&quot;value&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679096492"><a href="#local-6989586621679096492"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&#8592;</span><span> </span><span class="hs-identifier hs-var">cpInteger</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lang.L2C.Data.html#IntV"><span class="hs-identifier hs-var">IntV</span></a><span> </span><a href="#local-6989586621679096492"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-73"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679096493"><a href="#local-6989586621679096493"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&#8592;</span><span> </span><a href="Util.Lex.html#pBool"><span class="hs-identifier hs-var">pBool</span></a><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lang.L2C.Data.html#BoolV"><span class="hs-identifier hs-var">BoolV</span></a><span> </span><a href="#local-6989586621679096493"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-74"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-identifier">pAnswer</span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-identifier hs-type">CParser</span><span> </span><span class="hs-identifier hs-type">TokenBasic</span><span> </span><a href="Lang.L2C.Data.html#Answer"><span class="hs-identifier hs-type">Answer</span></a><span>
</span><a name="line-77"></a><a name="pAnswer"><a href="Lang.L2C.Util.html#pAnswer"><span class="hs-identifier">pAnswer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cpNewContext</span><span> </span><span class="hs-string">&quot;answer&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-78"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679096494"><a href="#local-6989586621679096494"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&#8592;</span><span> </span><a href="Lang.L2C.Util.html#pValue"><span class="hs-identifier hs-var">pValue</span></a><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lang.L2C.Data.html#ValueA"><span class="hs-identifier hs-var">ValueA</span></a><span> </span><a href="#local-6989586621679096494"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-79"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier hs-var">cpSyntax</span><span> </span><span class="hs-string">&quot;bad&quot;</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Lang.L2C.Data.html#BadA"><span class="hs-identifier hs-var">BadA</span></a><span>
</span><a name="line-80"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-identifier">parseExpr</span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-identifier hs-type">&#120138;</span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Lang.L2C.Data.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span>
</span><a name="line-83"></a><a name="parseExpr"><a href="Lang.L2C.Util.html#parseExpr"><span class="hs-identifier">parseExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">parseIO</span><span> </span><a href="Lang.L2C.Util.html#pExpr"><span class="hs-identifier hs-var">pExpr</span></a><span> </span><span class="hs-operator hs-var">*&#8728;</span><span> </span><span class="hs-identifier hs-var">tokenizeIO</span><span> </span><a href="Util.Lex.html#lexer"><span class="hs-identifier hs-var">lexer</span></a><span> </span><span class="hs-operator hs-var">&#8728;</span><span> </span><span class="hs-identifier hs-var">tokens</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-identifier">quoteExpr</span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-identifier hs-type">HS.String</span><span> </span><span class="hs-glyph">&#8594;</span><span> </span><span class="hs-identifier hs-type">QQ.Q</span><span> </span><span class="hs-identifier hs-type">QQ.Exp</span><span>
</span><a name="line-86"></a><a name="quoteExpr"><a href="Lang.L2C.Util.html#quoteExpr"><span class="hs-identifier">quoteExpr</span></a></a><span> </span><a name="local-6989586621679096495"><a href="#local-6989586621679096495"><span class="hs-identifier">cs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-87"></a><span>  </span><a name="local-6989586621679096496"><a href="#local-6989586621679096496"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&#8592;</span><span> </span><span class="hs-identifier hs-var">QQ.runIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lang.L2C.Util.html#parseExpr"><span class="hs-identifier hs-var">parseExpr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">string</span><span> </span><a href="#local-6989586621679096495"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-special">[|</span><span> </span><a href="#local-6989586621679096496"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">|]</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-identifier">l2c</span><span> </span><span class="hs-glyph">&#8759;</span><span> </span><span class="hs-identifier hs-type">QQ.QuasiQuoter</span><span>
</span><a name="line-91"></a><a name="l2c"><a href="Lang.L2C.Util.html#l2c"><span class="hs-identifier">l2c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">QQ.QuasiQuoter</span><span> </span><a href="Lang.L2C.Util.html#quoteExpr"><span class="hs-identifier hs-var">quoteExpr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">HS.fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">chars</span><span> </span><span class="hs-string">&quot;quote pattern - I can't even&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">HS.fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">chars</span><span> </span><span class="hs-string">&quot;quote type - I can't even&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">HS.fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">chars</span><span> </span><span class="hs-string">&quot;quote dec - I can't even&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a></pre></body></html>